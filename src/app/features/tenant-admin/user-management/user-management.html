<div class="user-container animate-fade-in">
    <!-- Page Header -->
    <div class="page-header flex justify-between items-end mb-12">
        <div>
            <div class="flex items-center gap-2 mb-2">
                <span class="pulse-dot"></span>
                <span class="text-[10px] font-black text-primary uppercase tracking-[0.2em]">Workspace Directory</span>
            </div>
            <h1 class="text-4xl font-black tracking-tight">User Intelligence</h1>
            <p class="text-muted mt-2 max-w-lg font-medium">Manage permissions, track enrollment clusters, and
                orchestrate member lifecycle.</p>
        </div>
        <div class="header-actions">
            <button class="invite-btn-vibe" (click)="toggleInviteModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                    class="mr-2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <line x1="19" y1="8" x2="19" y2="14"></line>
                    <line x1="22" y1="11" x2="16" y2="11"></line>
                </svg>
                Invite New Member
            </button>
        </div>
    </div>

    <!-- Ultra-Premium Toolbar -->
    <div class="toolbar-premium mb-8">
        <div class="toolbar-inner group">
            <!-- Search Hub -->
            <div class="search-hub flex-1">
                <div class="search-wrapper">
                    <svg class="search-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" [(ngModel)]="searchQuery"
                        placeholder="Search by name, email or role fingerprints..." class="search-input-vibe">
                    <div class="search-shortcuts">
                        <kbd>âŒ˜</kbd>
                        <kbd>K</kbd>
                    </div>
                    <button class="clear-search" *ngIf="searchQuery" (click)="searchQuery = ''">âœ•</button>
                </div>
            </div>

            <div class="divider-v"></div>

            <!-- Filter Cluster -->
            <div class="filter-cluster flex items-center gap-4">
                <div class="premium-select-wrapper">
                    <label>Identity</label>
                    <ng-select [items]="identities" bindLabel="label" bindValue="value" [(ngModel)]="selectedRole"
                        [clearable]="false" [searchable]="false" appendTo="body" class="premium-ng-select">
                    </ng-select>
                </div>

                <div class="premium-select-wrapper">
                    <label>Lifecycle</label>
                    <ng-select [items]="lifecycles" bindLabel="label" bindValue="value" [(ngModel)]="selectedStatus"
                        [clearable]="false" [searchable]="false" appendTo="body" class="premium-ng-select">
                    </ng-select>
                </div>

                <button class="btn-config-vibe" title="Advanced Matrix Filters">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Quick Stats Strip -->
        <div class="toolbar-footer">
            <div class="stat-mini">
                <span class="label">Total Population:</span>
                <span class="value font-black">{{ users.length }}</span>
            </div>
            <div class="stat-mini">
                <span class="label">Filtered:</span>
                <span class="value text-primary font-black">{{ filteredUsers.length }}</span>
            </div>
            <div class="flex-1"></div>
            <span class="sync-text">Last Synced: Just now</span>
        </div>
    </div>

    <!-- Premium Users Table -->
    <div class="table-container card p-0 border-none shadow-2xl overflow-hidden rounded-[24px]">
        <table class="user-table-premium">
            <thead>
                <tr>
                    <th class="w-16 text-center">
                        <label class="checkbox-vibe">
                            <input type="checkbox">
                            <span class="checkmark"></span>
                        </label>
                    </th>
                    <th>WORKSPACE MEMBER</th>
                    <th>IDENTITY ROLE</th>
                    <th>JOURNEY START</th>
                    <th>CURRENT PULSE</th>
                    <th class="text-right px-8">ACTIONS</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let user of filteredUsers" class="group transition-all">
                    <td class="text-center">
                        <label class="checkbox-vibe">
                            <input type="checkbox">
                            <span class="checkmark"></span>
                        </label>
                    </td>
                    <td>
                        <div class="member-cell">
                            <div class="avatar-hub">
                                <div class="member-avatar-vibe shadow-sm"
                                    [style.background]="'linear-gradient(135deg, hsl(' + (user.id * 45) % 360 + ', 70%, 95%), white)'"
                                    [style.color]="'hsl(' + (user.id * 45) % 360 + ', 70%, 40%)'">
                                    {{ user.name.charAt(0) }}
                                </div>
                                <div class="pulse-indicator" [class.online]="user.status === 'Active'"></div>
                            </div>
                            <div class="member-meta">
                                <span class="name block font-black tracking-tight">{{ user.name }}</span>
                                <span class="email text-[11px] font-bold text-muted lowercase">{{ user.email
                                    }}</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="role-badge-vibe" [class]="user.role.toLowerCase()">
                            <svg *ngIf="user.role === 'Admin'" xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            <svg *ngIf="user.role !== 'Admin'" xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            {{ user.role }}
                        </div>
                    </td>
                    <td>
                        <div class="date-cell-vibe">
                            <span class="date">{{ user.joined | date:'MMM dd, yyyy' }}</span>
                        </div>
                    </td>
                    <td>
                        <div class="status-badge-vibe" [class]="user.status.toLowerCase()">
                            {{ user.status }}
                        </div>
                    </td>
                    <td class="text-right px-8">
                        <div
                            class="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-all translate-x-4 group-hover:translate-x-0">
                            <button class="action-btn-vibe edit" title="Modify Identity">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                </svg>
                            </button>
                            <button class="action-btn-vibe toggle" (click)="toggleUserStatus(user)"
                                [title]="user.status === 'Active' ? 'Suspend Node' : 'Initialize Node'">
                                <svg *ngIf="user.status === 'Active'" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                <svg *ngIf="user.status !== 'Active'" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z" />
                                </svg>
                            </button>
                            <button class="action-btn-vibe delete" (click)="deleteUser(user)" title="Terminate Member">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Pagination Simulator -->
        <div class="pagination-footer flex justify-between items-center px-8 py-5 bg-card border-t border-color">
            <span class="text-[10px] font-black text-muted uppercase tracking-widest">Page 1 of 5</span>
            <div class="pagination-btns flex gap-1">
                <button class="p-btn active">1</button>
                <button class="p-btn">2</button>
                <button class="p-btn">3</button>
                <span class="px-2 text-slate-300">...</span>
                <button class="p-btn">12</button>
            </div>
        </div>
    </div>

    <!-- Redesigned Invite Modal (Preserved logic) -->
    <div class="modal-overlay glass-vibe" *ngIf="showInviteModal">
        <div class="modal-card-vibe animate-scale-up">
            <!-- Modal styling in CSS updated -->
            <div class="modal-header-vibe">
                <div class="header-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                        class="text-white">
                        <path
                            d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z">
                        </path>
                        <path
                            d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z">
                        </path>
                        <path d="M9 12H4s.55-3.03 2-5c1.62-2.2 5-3 5-3"></path>
                        <path d="M12 15v5s3.03-.55 5-2c2.2-1.62 3-5 3-5"></path>
                    </svg>
                </div>
                <div class="header-text">
                    <h2 class="text-xl font-black">New Onboarding</h2>
                    <p class="text-[10px] font-bold text-muted uppercase tracking-widest mt-1">Workspace Credentials
                    </p>
                </div>
                <button class="btn-close-vibe" (click)="toggleInviteModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="modal-body-vibe pt-8">
                <div class="input-field mb-6">
                    <label>Full Name</label>
                    <input type="text" [(ngModel)]="newUser.name" placeholder="Alex Rivera">
                </div>

                <div class="input-field mb-6">
                    <label>Corporate Email</label>
                    <input type="email" [(ngModel)]="newUser.email" placeholder="alex@company.com">
                </div>

                <div class="role-grid-vibe mb-8">
                    <div class="role-card-vibe" [class.selected]="newUser.role === 'Student'"
                        (click)="newUser.role = 'Student'">
                        <span class="icon">ðŸŽ“</span>
                        <span class="label">Student</span>
                    </div>
                    <div class="role-card-vibe" [class.selected]="newUser.role === 'Instructor'"
                        (click)="newUser.role = 'Instructor'">
                        <span class="icon">ðŸ‘”</span>
                        <span class="label">Instructor</span>
                    </div>
                </div>

                <div class="modal-footer-vibe">
                    <button class="btn-cancel" (click)="toggleInviteModal()">Discard</button>
                    <button class="btn-submit shadow-xl shadow-primary/30" (click)="sendInvite()"
                        [disabled]="isInviting">
                        {{ isInviting ? 'Deploying...' : 'Grant Access' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>